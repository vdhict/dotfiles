{{- /* Environment detection - runs every time */ -}}
{{- $ubuntu := hasKey .chezmoi.osRelease "ubuntuCodename" -}}
{{- $debian := eq .chezmoi.osRelease.id "debian" -}}
{{- $macos := eq .chezmoi.os "darwin" -}}
{{- $linux := eq .chezmoi.os "linux" -}}
{{- $wsl := or (env "WSL_DISTRO_NAME") (env "IS_WSL") | not | not -}}

{{- /* Container detection - check multiple indicators */ -}}
{{- $docker := false -}}
{{- if stat "/.dockerenv" -}}
{{-   $docker = true -}}
{{- end -}}
{{- $devcontainer := or (env "REMOTE_CONTAINERS") (env "CODESPACES") (env "VSCODE_REMOTE_CONTAINERS_SESSION") (env "GITPOD_HOST") $docker | not | not -}}

{{- $gnome := lookPath "gnome-shell" | not | not -}}
{{- $headless := or (env "SSH_CLIENT" | not | not) (not (or (env "DISPLAY") (env "WAYLAND_DISPLAY"))) -}}

{{- /* Minimum mode: auto-enabled for containers or unsupported OS - NO PROMPT */ -}}
{{- $minimum := or $devcontainer (not (or $ubuntu $debian $macos)) -}}

{{- /* User info - fixed values */ -}}
{{- $name := "Sander van der Heijden" -}}
{{- $email := "sheijden@vdh-ict.nl" -}}

sourceDir: "{{ .chezmoi.workingTree }}"

verbose: true
pager: ""

diff:
  exclude:
    - scripts
status:
  exclude:
    - always

hooks:
  read-source-state:
    pre:
      command: "{{ .chezmoi.workingTree }}/home/.chezmoihooks/ensure-pre-requisites.sh"

data:
  # Platform detection
  is_ubuntu: {{ $ubuntu }}
  is_debian: {{ $debian }}
  is_macos: {{ $macos }}
  is_linux: {{ $linux }}
  is_wsl: {{ $wsl }}
  is_devcontainer: {{ $devcontainer }}
  is_gnome: {{ $gnome }}
  is_headless: {{ $headless }}
  is_minimum: {{ $minimum }}

  # User info
  name: {{ $name | quote }}
  email: {{ $email | quote }}

  # 1Password configuration
  op_vault: "Employee"
  op_ssh_item: "Git Signing Key"

  # XDG paths
  paths:
    cache: {{ .chezmoi.homeDir }}/.cache
    config: {{ .chezmoi.homeDir }}/.config
    local: {{ .chezmoi.homeDir }}/.local

  # Editor
  editor: "cursor --wait"

  # Architecture
  uname_arch: {{ output "uname" "-m" | trim | quote }}

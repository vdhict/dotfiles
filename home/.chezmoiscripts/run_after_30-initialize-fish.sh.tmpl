#!/usr/bin/env bash
# {{ template "scripts-library" }}

true || source ../.chezmoitemplates/scripts-library

# Ensure fish is installed
if ! command -v fish &>/dev/null; then
  log_error "Fish shell not found. Please install fish first."
  exit 1
fi

FISH_PATH=$(command -v fish)

# Add fish to /etc/shells if not present
if ! grep -q "${FISH_PATH}" /etc/shells 2>/dev/null; then
  log_task "Adding fish to /etc/shells..."
  echo "${FISH_PATH}" | sudo tee -a /etc/shells >/dev/null
fi

# Set fish as default shell (skip in test/CI)
{{ if not .is_devcontainer }}
if [[ "${SHELL}" != "${FISH_PATH}" ]]; then
  log_task "Setting fish as default shell..."
  not_during_test sudo chsh -s "${FISH_PATH}" "$(whoami)"
  log_info "Fish set as default shell. Please log out and back in."
fi
{{ end }}

log_success "Fish shell initialized"

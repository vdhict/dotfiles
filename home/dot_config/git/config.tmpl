# Git Configuration
# Managed by chezmoi

[include]
  path = alias

[color]
  ui = auto

[core]
  autocrlf = input
  editor = cursor --wait
  excludesfile = {{ .paths.config }}/git/ignore
{{- if not .is_minimum }}
  pager = delta
{{- end }}

{{ if (eq .chezmoi.os "darwin") -}}
[credential]
  helper = osxkeychain
{{ end -}}

{{ if .is_wsl -}}
[credential]
  helper = /mnt/c/Program\\ Files/Git/mingw64/bin/git-credential-manager.exe
{{ end -}}

{{- if not .is_minimum }}
[delta]
  features = decorations
  light = false
  navigate = true
  side-by-side = true

[interactive]
  diffFilter = delta --color-only
{{- end }}

[diff]
  colorMoved = default
  tool = cursor

[difftool "cursor"]
  cmd = cursor --wait --diff $LOCAL $REMOTE

[fetch]
  prune = true

[init]
  defaultBranch = main

[merge]
  conflictstyle = diff3
  tool = cursor

[mergetool "cursor"]
  cmd = cursor --wait $MERGED

[pager]
  branch = false

[pull]
  rebase = true

[push]
  autoSetupRemote = true
  default = current

[rebase]
  autoStash = true

[status]
  submoduleSummary = false

[user]
  email = {{ .email }}
  name = {{ .name }}

{{- if not .is_devcontainer }}
# Commit signing with SSH key from 1Password
[commit]
  gpgSign = true

[tag]
  gpgSign = true

[gpg]
  format = ssh

[gpg "ssh"]
  allowedSignersFile = ~/.ssh/allowed_signers

[user]
  signingkey = ~/.ssh/id_ed25519.pub

# Use SSH for GitHub
[url "ssh://git@github.com/"]
  pushInsteadOf = https://github.com/
{{- end }}

# Aliases
[alias]
  # Status
  s = status -sb
  st = status

  # Logging
  lg = log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit
  ll = log --pretty=format:'%C(yellow)%h%Cred%d %Creset%s%Cblue [%cn]' --decorate --numstat
  lc = log --pretty=format:'%h %s' --graph

  # Branches
  co = checkout
  cob = checkout -b
  br = branch
  bra = branch -a

  # Commits
  ci = commit
  cm = commit -m
  ca = commit --amend
  can = commit --amend --no-edit

  # Diff
  d = diff
  dc = diff --cached
  dt = difftool

  # Reset
  unstage = reset HEAD --
  undo = reset --soft HEAD~1

  # Stash
  stl = stash list
  stp = stash pop
  sts = stash save

  # Pull/Push
  pl = pull
  ps = push
  psf = push --force-with-lease

  # Misc
  last = log -1 HEAD
  contributors = shortlog --summary --numbered
  aliases = config --get-regexp alias
